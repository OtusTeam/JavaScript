.hidden[
- [Async functions - making promises friendly - Jake Archibald](https://developers.google.com/web/fundamentals/primers/async-functions)
- [Historical document on `Promises` specification](https://promisesaplus.com/)
- https://hackernoon.com/6-reasons-why-javascripts-async-await-blows-promises-away-tutorial-c7ec10518dd9
- https://medium.com/@stevekonves/three-javascript-async-patterns-1d2e7094860a
- https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise
]

.center.icon[![otus main](assets/otus-1.png)]

---

class: white
background-image: url(assets/title.svg)
.top.icon[![otus main](assets/otus-2.png)]

# Modern JavaScript Frameworks
## Возможности JavaScript
### Михаил Кузнецов

---

class: top white
background-image: url(assets/sound.svg)
.top.icon[![otus main](assets/otus-2.png)]

.sound-top[
  # Как меня слышно и видно?
]

.sound-bottom[
  ## > Напишите в чат
  ### **+** если все хорошо
  ### **–** если есть проблемы cо звуком или с видео
]

---

# Modern JavaScript Frameworks

.mario.mario-1[![mario](assets/mario.png)]

| ![JS](assets/icons/trim/js.png) | ![Node](assets/icons/trim/node.png) | ![React](assets/icons/trim/react.png) | ![Vue](assets/icons/trim/vue.png) | ![Angular](assets/icons/trim/angular.png) |
|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|
| ![Google Chrome](assets/icons/trim/google_chrome.png) | ![v8](assets/icons/trim/v8.png) | ![flux](assets/flux.png) | | ![rxjs](assets/icons/trim/rxjs.png) |
| ![Web Components](assets/icons/trim/webcomponents.png) | ![Express](assets/icons/trim/express.png) | ![redux](assets/icons/trim/redux.png) | | |
| ![polymer](assets/icons/trim/polymer.png) | ![GraphQL](assets/icons/trim/graphql.png) | ![react-router](assets/icons/trim/react-router.png) 
| ![NPM](assets/icons/trim/npm.png) | ![ts](assets/icons/trim/ts.png) | |

---

# Темы предыдущего занятия
.right-image[![JS](assets/js.png)]

- Типы данных
- Переменные 
- Функции
- Замыкания

---

# Вопрос - Замыкания

### Какой контекст будет у функции, если к ней применить `bind()` дважды и почему?

```js
var fn = function() {
  console.log(this)
}
var a = fn.bind(1)
a() // a?
var b = a.bind(2)
b() // b?
```

---

# Темы

.right-image[![JS](assets/js.png)]

- Наследование
- Promise
- Async Patterns
- Обзор ES6 Features

---

# Цели Занятия

- Вспомнить и применять основные техники языка `JavaScript`
- `Promise` и другие асинхронные паттерны
- Попрактиковаться с технологиями `Promise`

---

# Вопрос
.right-image[![JS](assets/inheritance.png)]

- Какие задачи решает наследование?
- Что означают эти термины:
  
  - inheritance, 
  - polymorphism, 
  - encapsulation, 
  - abstraction?
  
  .hidden[
    https://medium.com/@cancerian0684/what-are-four-basic-principles-of-object-oriented-programming-645af8b43727
    
    `abstraction` is removing irrelevant data so a program is easier to understand
  ]
  
- Как реализовать наследование в `JavaScript`?

---

# Наследование в JS

 - JS использует "прототипное наследование"
 - свойство `.prototype`
 - конструктор и использование
 - `class` - лишь "синтаксический сахар" для задания конструктора и прототипа
 - `__proto__` - ссылка на объект прототип (легаси!)

.right-code[
```javascript

function A(name){
  this.name = name
}

const a = new A('test')
```
]

---

# Наследование в JS

Методы:
 - `typeOf`
 - `instanceOf`
 - `Object.create(proto, [propertiesObject])` устанавливает аргумент значением `__proto__` 
 - `Object.getPrototypeOf`

[MDN Object.create](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create)

---

# Классы с ES6+

.right-code[
```javascript
class Pie { 
  constructor(name) { 
    this.name = name
  }
  bake(){
    console.log(`${this.name} baked!`)
  }
}

class Pizza extends Pie { 
  constructor(name, ingridients = []){
    super.constructor(name)
    this.ingridients = ingridients
  }
  bake() {
    super.bake()
  }
  addIngridients(ingridient){
    this.ingridients.push(ingridient)
  }
}
```
]

- `class C` - декларация класса
- `[extends P] ` - наследование
- `constructor(), methods()` - конструктор и методы класса
- `new C()` - создание инстансов класса
- `get / set` - функции доступа / присваивания
- `static` - статичные свойства и методы
- `super` - обращение к родительскому классу

---

# Private

```
class Pie {
 #test = 1
 static #test = 1
 
 log() {
   console.log(this.#test)
 }
}
```

Пока на Stage 3 - [MDN Private_class_fields](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields)

---

class: center
## Inheritance
## Q&A

---

# Promise

### Техника написания асинхронного кода

![Promise](assets/promises-full.png)

.hidden[
  ![__proto__ keyword](assets/3.2/promise_flow.jpg)
]

---

# Promise

- `resolve()` - успешное завершение
- `reject()` - выполнено с ошибкой

```
new Promise((resolve, reject) => {
  resolve('Hello')
})

// Alternative
Promise.resolve(value)
Promise.reject(reason)
```

---

# Promise callbacks

- `then()` - вызвана при `resolve()` с результатом 
- `catch()` - при `reject`

```
Promise.resolve(1) // reject() 
  .then((a) => { console.log(a); throw 'Oh no!' }) 
  .catch(reason => { console.error(reason) })
  
// Alternative
// then(onThen, onCatch)
```

- Chaining...

  - `reject()` может быть неявно спровоцировано исключением
  - `reject()` следует до `catch()`

---

# Вопрос

### Что будет выведено в консоль?

```
Promise.resolve(1)
  .then(console.log)
  .then(console.log)
```

### А здесь?

```
Promise.reject()
  .then(() => { throw 3 })
  .catch(() => 4)
  .then((a) => console.log(a))
```

---

# Дополнительные методы

- `finally()` - выполнится при любом исходе
- `all()` - параллельные promises
- `race()` - как только один из promise-ов завершится


```
Promise.resolve()
  .finally(() => 'done')// parallel
  
Promise.all([promise, promise2])
  .then(() => 'then')
```

---

# async / await

### «синтаксический сахар» для работы с `Promise`

- `await` внутри `async`
- `return` возвращается `Promise`

```
const promiseFn = () => 
  new Promise(resolve => 
    setTimeout(() => resolve(3.14), 500)
  )

async function asyncFn() { 
  const Pi = await promiseFn() 
  console.log(Pi)
}

asyncFn()
```

---

# Вопрос

### Что здесь не так?

```
new Promise((resolve, reject) => {
  const result = doSomething()
  if (result) {
    resolve(result)
  }

  doSomethingElse()
  reject(new Error('Empty result'))
})
```

---

class: center

## Promise
## Q&A
## ->
## Async Patterns

---

# Async Patterns

.right-image[
  ![async](assets/async-patterns.png)
]

- `Callback`
- `Promise`
- Async / Await
- Generator / Iterator
- `Observable`

---

# Iterators

```
const iterable = {
 [Symbol.iterator]() {
   let step = 0
   const iterator = {
     next() {
       if (step <= 2) {
         step++
       }
       switch (step) {
         case 1:
           return { value: 'hello', done: false }
         case 2:
           return { value: 'world', done: false }
         default:
           return { value: undefined, done: true }
       }
     }
   }
   return iterator
 }
}
```

- Как можно итерироваться?

.hidden[
- Symbol.iterator()
- iterator factory  
- { next() }
- ({ value, done })

var it = iterable[Symbol.iterator]()
for (i of iterable) {
  console.log(i)
}
]

---

# Generator

Специальные функции - генераторы `function*` могут останавливать свое исполнение с помощью конструкций `yield` и `yield*`, возвращая множества значений

.half-image[
  ![async](assets/generator.png)
]

```
new GeneratorFunction('a', 'yield a * 2') 
```

---

# Пример [iterating async requests](https://gist.github.com/korzio/52774b2cf2281662ca0e6ef4600bf6bd)

```
async function get(n) {
  return new Promise(r => setTimeout(() => r(n), n * 100))
}

async function* asyncGenerator(arr) {
  let anyResolve

  arr.map(get).forEach(async request => {
    const anyResult = await request
    anyResolve(anyResult)
  })

  while(true) {
    yield await new Promise((resolve) => {
      anyResolve = resolve
    })
  }
}

(async function() {
  for await (let num of asyncGenerator([4, 3, 2, 1, 0])) {
    console.log(num)
  }
})()
```

---

# ES6 Features

.right-code[
- Arrow Functions
- Classes
- Enhanced Object Literals
- String interpolation
- Destructuring
- Default
- Spread
- Spread + Object Literals
- Rest
- Let, Const
- For..of
- Unicode
- Modules & Module Loaders
]

- Set, WeakSet
- Map, WeakMap
- Proxies
- Symbols
- Binary and Octal
- Reflect
- Tail Call Optimization

---

# На занятии

- Разобрали наследование и его реализацию в JavaScript
- Теория и методы, при работе с технологией Promise
- Фичи ES6 и далее

---

# Что почитать
.right-image[![JS](assets/js.png)]

### ECMAScript 6 (2015)

- http://es6-features.org/ - кратко
- http://speakingjs.com/es5/ - Speaking JavaScript
- https://learn.javascript.ru/promise


---

# Modern JavaScript Frameworks

.mario.mario-2[![mario](assets/mario.png)]

| ![JS](assets/icons/trim/js.png) | ![Node](assets/icons/trim/node.png) | ![React](assets/icons/trim/react.png) | ![Vue](assets/icons/trim/vue.png) | ![Angular](assets/icons/trim/angular.png) |
|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|
| ![Google Chrome](assets/icons/trim/google_chrome.png) | ![v8](assets/icons/trim/v8.png) | ![flux](assets/flux.png) | | ![rxjs](assets/icons/trim/rxjs.png) |
| ![Web Components](assets/icons/trim/webcomponents.png) | ![Express](assets/icons/trim/express.png) | ![redux](assets/icons/trim/redux.png) | | |
| ![polymer](assets/icons/trim/polymer.png) | ![GraphQL](assets/icons/trim/graphql.png) | ![react-router](assets/icons/trim/react-router.png) 
| ![NPM](assets/icons/trim/npm.png) | ![ts](assets/icons/trim/ts.png) | |

---

# Самостоятельная работа

Написать функцию promiseReduce, которая получает на вход `asyncFunctions`, `reduce`, `initialValue`. 

promiseReduce поочередно вызывает переданные асинхронные функции и выполняет reduce функцию сразу при получении результата до вызова следующей асинхронной функции.

```
function promiseReduce(asyncFunctions, reduce, initialValue) {/* ? */}

const fn1 = () => Promise.resolve(1)
const fn2 = () => new Promise(resolve => {
 setTimeout(() => resolve(2), 1000)
})

promiseReduce([fn1, fn2], (memo, value) => memo * value, 2)
/* => 4 */
```

---

class: white
background-image: url(assets/title.svg)
.top.icon[![otus main](assets/otus-2.png)]

# Спасибо за внимание!
.black[ 
## Пожалуйста, пройдите [опрос](https://otus.ru/polls/7204/)
## в личном кабинете 
]

- Все ли темы были понятны? (да - нет)
- Легкий материал или нет? (1 просто - 10 сложно)
