class: title

## Web Components
### .oc-blue-4.ri-twitter-fill[] AlexKorzhikov

.photo[
  ![](assets/team/alex-portret.png)
]

.right.bottom[
  ### 23 –∏—é–ª—è 2020
]

---

class: top white
background-image: url(assets/sound.svg)
.top.icon[![otus main](assets/otus-2.png)]

.sound-top[
  # –ö–∞–∫ –º–µ–Ω—è —Å–ª—ã—à–Ω–æ –∏ –≤–∏–¥–Ω–æ?
]

.sound-bottom[
  ## > –ù–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç
  ### **+** –µ—Å–ª–∏ –≤—Å–µ —Ö–æ—Ä–æ—à–æ
  ### **‚Äì** –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã c–æ –∑–≤—É–∫–æ–º –∏–ª–∏ —Å –≤–∏–¥–µ–æ
]

---

# –¢–µ–º—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–Ω—è—Ç–∏—è

.right-image[![JS](assets/js.png)]

- Unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- TDD
- Mocks
- BDD

### Functional Programming —Å `JavaScript` 
### -> –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω

---

# –¢–µ–º—ã

.right-image[
  ![Web Components](assets/icons/trim/webcomponents.png)
]

- Custom Elements
  - Standalone Elements
  - Built-in Elements
  - LifeCycle Hooks
  
- Shadow DOM
  - DOM
  - Slots
  - Styles

### –¶–µ–ª–∏

- –ü–æ–Ω–∏–º–∞—Ç—å –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≤–µ–± —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏ `Custom Elements`, `Shadow DOM`

---

# Custom Elements


### "Custom elements provide a way for authors to build their own fully-featured DOM elements"

### "A custom element is an element that is custom" ü§î

.right[
  ¬© WHATWG
  
  ![Polymer](assets/icons/trim/Polymer.png)
  ![Web Components](assets/icons/trim/webcomponents.png)
]

---

# –í—Å–µ —Å—É—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ù–∞–ø—Ä–∏–º–µ—Ä, select, input & form

```html
<select>
<option value="1">7</option>
</select>
```

### –ß—Ç–æ –µ—Å–ª–∏ –Ω–∞–º –Ω—É–∂–µ–Ω multi-select?

```html
<multi-select>
  <option value="1">8</option>
  <option value="2">13</option>
</multi-select>
```

---

# –ü—Ä–∏–º–µ—Ä

```html
<script>
class HelloWorldElement extends HTMLElement {
  connectedCallback() {
    this.textContent = "Hello World"
  }
}
customElements.define('hello-world-element', HelloWorldElement);
</script>
```

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

---

# –î–µ–∫–ª–∞—Ä–∞—Ü–∏—è

```
customElements.define("flag-icon", FlagIcon) 
// [a-z](PCENChar)* '-' (PCENChar)*

// use createElement
const flagIcon = document.createElement("flag-icon")
flagIcon.country = "jp"
document.body.appendChild(flagIcon)

// use new
const flagIcon = new FlagIcon()
flagIcon.country = "jp"
document.body.appendChild(flagIcon)
// use HTML document 
```

---

# –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### –°–æ–∑–¥–∞—Ç—å `hello-component` —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∂–µ—Ç `alert` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

```
class HelloComponent extends HTMLElement { // ?}

// customElements.define ? 

<!-- ? -->
```

### –ö–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —É `display hello-component` —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ `DOM`?

---

# –í–æ–ø—Ä–æ—Å

- –°–ª–æ–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `button`?
- –ß—Ç–æ –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

.center[![question](assets/question.png)]

---

# HTMLElement

```
class HelloComponent extends HTMLElement { }
```

![HTMLElement Hierarchy](assets/HTMLElement_Hierarchy.gif)

---

# Customized Built-in Elements

- `reuse && extend` - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- `extends && is` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ç—Ä–∏–±—É—Ç—ã

```
class PlasticButton extends HTMLButtonElement {
  constructor() {
    super() // ... 
  }
}

customElements.define("plastic-button",
  PlasticButton, { extends: "button" }
)

document.createElement("button", {
  is: "plastic-button"
}) 
```

```html
<button is="plastic-button">Click Me!</button>
```

---

# –î–µ–º–æ

### [–°–æ–∑–¥–∞—Ç—å custom label –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏](/Users/RD25XO/Developer/experiments/notes/otus/polymer/2/label.html)

- –ù–∞–ø–æ–º–∏–Ω–∞–µ—Ç —á—Ç–æ-–Ω–∏–±—É–¥—å?
- –ß—Ç–æ –±—ã –í—ã –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ `customized built-in elements`?

---

# CustomElementRegistry

.right-image[
  ![Web Components](assets/icons/trim/webcomponents.png)
]

- `window.customElements` - registry instance
- `define()`
- `get()`
- `whenDefined()`
- `upgrade()`

### –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –¥–µ–∫–ª–∞—Ä–∏—Ä–æ–≤–∞—Ç—å `custom element` –ø–æ—Å–ª–µ –µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è?

---

# Flow

```html
<example-element></example-element>
```

```
const inDocument = document.querySelector('example-element')
const outOfDocument = document.createElement('example-element')

console.assert(inDocument instanceof HTMLElement)
console.assert(outOfDocument instanceof HTMLElement)

class ExampleElement extends HTMLElement {}
customElements.define('example-element', ExampleElement)

console.assert(inDocument instanceof ExampleElement)
console.assert(!(outOfDocument instanceof ExampleElement))

// upgraded
document.body.appendChild(outOfDocument)
console.assert(outOfDocument instanceof ExampleElement)
```

---

# LifeCycle

.right-image[
  ![Web Components](assets/icons/trim/webcomponents.png)
]

- `constructor` (0)
- `attributeChangedCallback` (1) <= static `observedAttributes()`
- `connectedCallback` (2) - `DOM`
- `disconnectedCallback` (N) - `DOM`
- `adoptedCallback` (?) => "new document"

---

#  Attribute Change

```
class HelloWorldElement extends HTMLElement {
  static get observedAttributes() {
    return ['name']
  }
  attributeChangedCallback(name, oldValue, newValue) {
    this._name = newValue
  }
  connectedCallback() {
    this.name = this.getAttribute('name') || 'World'
  }
  get name() {
    return this._name
  }
  set name(name) {
    this.setAttribute('name', name)
    this.render()
  }
  render() {
    this.textContent = `Hello ${this.name}`
  }
}
```

---

# [–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞](/Users/RD25XO/Developer/experiments/notes/otus/polymer/2/lifecycle.html)

### –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ [–≤—Å–µ —Ö—É–∫–∏](https://jsfiddle.net/n5kyou86/1/) –∏—Å–ø–æ–ª–Ω–∏–ª–∏—Å—å (—Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Å–æ–ª–∏ –∏ ...?)

- `connectedCallback`
- `disconnectedCallback`
- `attributeChangedCallback`
- `adoptedCallback`
- `constructor`

.hidden[
  document.implementation.createHTMLDocument("New Document")
]

---

# Features & Requirements

- `Custom Elements` can be upgraded
- call `super()`
- work to be deferred to `connectedCallback()`
- constructor for state, default values, event listeners & shadow root

---

class: center
## Custom Elements
## Q&A

---

# How To

.half-image[
  ![shadow dom preferences](assets/shadow_dom_preferences.png)
  ![shadow dom chrome devtools](assets/shadow_dom_chrome_devtools.png)
]

---

# Shadow DOM

### "Shadow DOM fixes CSS and DOM. It introduces scoped styles to the web platform"

### "Shadow DOM removes the brittleness of building web apps"
 
¬© Eric Bidelman

---
 
# Features

- Isolated DOM - `document.querySelector()` –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- Composition - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- Scoped CSS - —Å—Ç–∏–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç
- Simplifies CSS - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

.center[
  ### –ü–æ—á—Ç–∏ `iframe`!
]

---

# Shadow Definitions

.right-image[![shadow dom](assets/shadow-tree-structure.png)]

- Tree - –æ—Ç–¥–µ–ª—å–Ω—ã–π `DOM`
- Root - `Document Fragment`
- Host - —ç–ª–µ–º–µ–Ω—Ç "—Ä–æ–¥–∏—Ç–µ–ª—å"
- `mode = 'open' || 'closed'`

```
const host = document.createElement('div')
const shadowRoot = host.attachShadow({ mode: 'open'})
shadowRoot.innerHTML = '<h1>ShadowDOM</h1>'

// host.shadowRoot === shadowRoot
// shadowRoot.host === host
// openOrCloseShadowRoot ?!
```

---

# Shadow DOM

### "...a method of combining multiple DOM trees into one hierarchy and how these trees interact with each other within a document, thus enabling better composition of the DOM"
 
¬© W3C

```
const host = document.createElement('div')
const shadowRoot = host.attachShadow({
  mode: 'open'
})

shadowRoot.innerHTML = `
  <style>h3{ color: red; }</style>
  <h3>Shadow DOM</h3>
`
```

---

# Slots

### Slots are **placeholders** inside your component that users can fill with their own markup

```html
<p>
  <slot name="my-text">default</slot>
</p>

<my-paragraph>
  <ul slot="my-text">
    <li>different text</li>
    <li>in a list</li>
  </ul>
</my-paragraph>
```

---

# oh-my-slot

```
customElements.define('oh-my-slot', class extends HTMLElement {
  constructor() {
    super()
    this.attachShadow({
      mode: 'open'
    })
  }
  connectedCallback() {
    this.shadowRoot.innerHTML = `My Element
      <slot name="title">Default</slot>
      <slot>Default</slot>`
  }
})
```

```html
<oh-my-slot>
  <h1 slot="title">Title</h1>
  <pre>Code</pre>
</oh-my-slot>
```

---

# [3 DOMs](/Users/RD25XO/Developer/experiments/notes/otus/polymer/2/slot.html)

.right-image[![shadow dom](assets/shadow_dom.png)]

- Light - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Shadow - —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- Flattened - —Ä–µ–∑—É–ª—å—Ç–∞—Ç 


```
this.shadowRoot.innerHTML = `My Element
  <slot name="title">Default</slot>
  <slot>Default</slot>`
```

```html
<oh-my-slot>
  <h1 slot="title">Title</h1>
  <pre>Code</pre>
</oh-my-slot>
```

---

# Styles

### Shadow DOM –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏

```html
#shadow-root
<style>
  #tabs {
    display: inline-flex;
    ...
  }
</style>
<div id="tabs">
  ...
</div>
```

---

# Features

- CSS —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤–Ω—É—Ç—Ä–∏ Shadow DOM –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- CSS —Å–µ–ª–µ–∫—Ç–æ—Ä—ã —Å–Ω–∞—Ä—É–∂–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É

```html
#shadow-root
 <style>
 :host {
 display: block; 
/* by default, custom elements are display: inline */
/* :host(.blue) {color: blue;} */
 }
 </style>
```

- `:host` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å—Ç–∏–ª–∏ –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ

- –°–Ω–∞—Ä—É–∂–∏ `host` –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ

- `:host-context()` –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

# [Demo](/Users/RD25XO/Developer/experiments/notes/otus/polymer/3/shadow-dom styles.html)

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π `style` –¥–ª—è –Ω–æ–≤–æ–≥–æ `Custom Element`
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–∏–ª—å `host` —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–Ω–∞—Ä—É–∂–∏ (`color` –∏–ª–∏ `background`)

---

# CSS custom properties (variables)

```css
element { --main-bg-color: brown;}

element { background-color: var(--main-bg-color);}
element { color: var(--my-var, red);}
```

- Inherited
(–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–µ host)
- Fallback
(–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)

---

# Custom styling

.right-code[
```css
::slotted(h1) {
  color: red;
}

@keyframes foo {
  from {
    color: red;
  }
  to {
    color: blue;
  }
  @apply --not-a-style-rule;
}
```
]

- `:defined` - –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
- `::slotted`

- Deprecated  
  - @apply (CSS Mixins)
  - ::content
  - ::shadow/deep/ 
  
---

# [CSS Shadow Parts](https://www.youtube.com/watch?v=yVrvOueeb3s)

```html
<template id="tabbed-custom-element">
  <div part="tab active">Tab 1</div> 
  <div part="tab">Tab 2</div> 
  <div part="tab">Tab 3</div>
</template>

<tabbed-custom-element></tabbed-custom-element>
```

- `parts, exportparts`
- `custom-element::part(foo) {}`
- `::part(part)`

---


# Docs

- [–°—Ç–∞—Ç—å–∏ –ø—Ä–æ Web Components](https://medium.com/@korzio/introduction-to-web-components-part-i-custom-elements-4de6713cef9d?source=friends_link&sk=d65a551d54c061251dbc05c2fc0560fe)

- [WHATWG Specification](https://html.spec.whatwg.org/multipage/custom-elements.html)

- [Polymer Guide](https://www.polymer-project.org/3.0/docs/devguide/custom-elements)

- [Google I/O 2014 - Polymer and Web Components change everything you know about Web development](https://www.youtube.com/watch?v=8OJ7ih8EE7s)

- [Web Components - MDN](https://developer.mozilla.org/en-US/docs/Web/Web_Components)

- [How JavaScript works: the internals of Shadow DOM + how to build self-contained components](https://blog.sessionstack.com/how-javascript-works-the-internals-of-shadow-dom-how-to-build-self-contained-components-244331c4de6e)

### –ù–∞ –∑–∞–Ω—è—Ç–∏–∏

- –†–∞–∑–æ–±—Ä–∞–ª–∏ –≤–µ–± —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é `Custom Elements`, `Shadow DOM`

---

# Modern JavaScript Frameworks

.mario.mario-10[![mario](assets/mario.png)]

| ![JS](assets/icons/trim/js.png) | ![Web Components](assets/icons/trim/webcomponents.png) | ![Node](assets/icons/trim/node.png) | ![Vue](assets/icons/trim/vue.png) | ![React](assets/icons/trim/react.png) | ![Angular](assets/icons/trim/angular.png) |
|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|:-------------:|
| ![Google Chrome](assets/icons/trim/google_chrome.png) | ![ts](assets/icons/trim/ts.png) | ![v8](assets/icons/trim/v8.png) | | ![redux](assets/icons/trim/redux.png) | ![rxjs](assets/icons/trim/rxjs.png) |
| ![NPM](assets/icons/trim/npm.png) | ![svelte](assets/svelte.png) | ![Express](assets/icons/trim/express.png) | | ![react-router](assets/icons/trim/react-router.png) | |
|  | ![polymer](assets/icons/trim/polymer.png) | ![GraphQL](assets/icons/trim/graphql.png) |

---

# –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

![no homework](assets/no-homework.png)

---

class: title

## –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ!
### –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–π–¥–∏—Ç–µ [**–æ–ø—Ä–æ—Å**](https://otus.ru/polls/12711/) –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

.right.bottom[
  ### 23 –∏—é–ª—è 2020
]
